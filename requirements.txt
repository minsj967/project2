plotly
import streamlit as st
import pandas as pd
import plotly.graph_objects as go

st.set_page_config(page_title="ì‹¤ë‚´ ê³µê¸°ì§ˆ ë¶„ì„", layout="centered")

st.title("ğŸ  í™˜ê¸° & ì—ë„ˆì§€ ì†Œë¹„ê°€ ì‹¤ë‚´ ê³µê¸°ì§ˆì— ë¯¸ì¹˜ëŠ” ì˜í–¥")

# ------------------------------
# ì…ë ¥ ì„¹ì…˜
# ------------------------------
st.sidebar.header("ì…ë ¥ ì„¤ì •")

ventilation_type = st.sidebar.selectbox(
    "í™˜ê¸° ë°©ì‹ ì„ íƒ",
    ["ìì—° í™˜ê¸°", "ê¸°ê³„ í™˜ê¸°", "í˜¼í•© í™˜ê¸°"]
)

energy_pattern = st.sidebar.selectbox(
    "ì—ë„ˆì§€ ì†Œë¹„ íŒ¨í„´",
    ["ë‚®ìŒ (ì—ë„ˆì§€ ì ˆì•½)", "ë³´í†µ", "ë†’ìŒ (ë‚œë°©/ëƒ‰ë°© ê³¼ë‹¤)"]
)

occupants = st.sidebar.slider("ì‹¤ë‚´ ì¸ì› ìˆ˜", 1, 10, 4)

# ------------------------------
# ê°€ìƒì˜ ë°ì´í„° ëª¨ë¸ë§
# ------------------------------
base_co2 = 400  # ì‹¤ì™¸ ê¸°ë³¸
co2_per_person = 150

ventilation_factor = {
    "ìì—° í™˜ê¸°": 1.5,
    "ê¸°ê³„ í™˜ê¸°": 1.0,
    "í˜¼í•© í™˜ê¸°": 0.8
}

energy_factor = {
    "ë‚®ìŒ (ì—ë„ˆì§€ ì ˆì•½)": 1.1,
    "ë³´í†µ": 1.0,
    "ë†’ìŒ (ë‚œë°©/ëƒ‰ë°© ê³¼ë‹¤)": 0.9
}

# ì˜ˆì¸¡ CO2 ê³„ì‚°
predicted_co2 = base_co2 + occupants * co2_per_person * ventilation_factor[ventilation_type] * energy_factor[energy_pattern]

# ê±´ê°• ì§€í‘œ í‰ê°€
if predicted_co2 < 800:
    health_risk = "ğŸŸ¢ ë‚®ìŒ"
elif predicted_co2 < 1200:
    health_risk = "ğŸŸ¡ ë³´í†µ"
else:
    health_risk = "ğŸ”´ ë†’ìŒ"

# ------------------------------
# ì¶œë ¥ ì„¹ì…˜
# ------------------------------
st.subheader("ğŸ“Š ê²°ê³¼ ìš”ì•½")

st.markdown(f"""
- **ì˜ˆìƒ COâ‚‚ ë†ë„**: `{int(predicted_co2)} ppm`
- **ë‘í†µ ë“± ê±´ê°• ìœ„í—˜ë„**: **{health_risk}**
""")

# ------------------------------
# Plotly ì‹œê°í™”
# ------------------------------
fig = go.Figure()

fig.add_trace(go.Bar(
    x=["ê¸°ì¤€ (ì‹¤ì™¸)", "ì˜ˆìƒ ì‹¤ë‚´ COâ‚‚ ë†ë„"],
    y=[400, predicted_co2],
    marker_color=["green", "crimson"]
))

fig.update_layout(
    title="ì‹¤ë‚´ COâ‚‚ ë†ë„ ë³€í™”",
    yaxis_title="COâ‚‚ ë†ë„ (ppm)",
    xaxis_title="êµ¬ë¶„",
    yaxis_range=[0, max(1600, predicted_co2 + 100)],
    template="plotly_white",
    height=400
)

st.plotly_chart(fig, use_container_width=True)

# ------------------------------
# ê²°ë¡ 
# ------------------------------
st.markdown("âœ… í™˜ê¸° ë°©ì‹ê³¼ ì—ë„ˆì§€ ì†Œë¹„ëŠ” ì‹¤ë‚´ ê³µê¸°ì§ˆê³¼ ê±´ê°•ì— ì§ì ‘ì ì¸ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ì¾Œì í•œ í™˜ê²½ì„ ìœ„í•´ íš¨ìœ¨ì ì¸ í™˜ê¸° ì‹œìŠ¤í…œì„ ì„ íƒí•˜ì„¸ìš”.")
